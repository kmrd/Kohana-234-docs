<html xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>
    general:controllers    [Kohana User Guide]
</title><meta name="generator" content="DokuWiki Release 2008-05-05"><meta name="robots" content="index,follow"><meta name="date" content="2008-11-02T15:03:55-0600"><meta name="keywords" content="general,controllers"><link rel="search" type="application/opensearchdescription+xml" href="..\lib\exe\opensearch.html" title="Kohana User Guide"><link rel="start" href="/"><link rel="contents" href="controllers-1.html?do=index" title="Index"><link rel="alternate" type="application/rss+xml" title="Recent Changes" href="..\feed.html"><link rel="alternate" type="application/rss+xml" title="Current Namespace" href="..\feed-2.html?mode=list&amp;ns=general"><link rel="alternate" type="text/html" title="Plain HTML" href="..\_export\xhtml\general\controllers.html"><link rel="alternate" type="text/plain" title="Wiki Markup" href="..\_export\raw\general\controllers.html"><link rel="stylesheet" media="all" type="text/css" href="..\_css\all.css"><link rel="stylesheet" media="screen" type="text/css" href="..\_css\kohana.css"><link rel="stylesheet" media="print" type="text/css" href="..\_css\print.css"><script type="text/javascript" charset="utf-8" src="..\_js\script.js"></script><link rel="shortcut icon" href="..\lib\tpl\kohana\images\favicon.html"><link rel="stylesheet" type="text/css" href="..\_css\my.css"></head><body>
<!-- Start Header -->
<div id="header">

<!-- Start Logo -->
<a id="logo" href="..\contents.html"><img src="..\_img\kohana.png" alt="Kohana"></a>
<!-- End Logo -->

</div>
<!-- End Header -->

<div class="menu clearfix">
<ul><li class="top active"><a href="..\contents.html">Contents</a></li>


<li class="top"><a href="..\contents.html">General<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="configuration.html" title="Configuration">Configuration</a></li>
				<li><a href="controllers.html" title="Controllers">Controllers</a></li>
				<li><a href="errorhandling.html" title="Error Handling">Error Handling</a></li>
				<li><a href="events.html" title="Events">Events</a></li>
				<li><a href="filesystem.html" title="Filesystem">Filesystem</a></li>
				<li><a href="helpers.html" title="Helpers">Helpers</a></li>
				<li><a href="hooks.html" title="Hooks">Hooks</a></li>
				<li><a href="i18n.html" title="Internationalization">Internationalization</a></li>
				<li><a href="libraries.html" title="Libraries">Libraries</a></li>
				<li><a href="loading.html" title="Loading">Loading</a></li>
				<li><a href="logging.html" title="Logging">Logging</a></li>
				<li><a href="models.html" title="Models">Models</a></li>
				<li><a href="modules.html" title="Modules">Modules</a></li>
				<li><a href="routing.html" title="Routing">Routing</a></li>
				<li><a href="urls.html" title="URLs">URLs</a></li>
				<li><a href="views.html" title="Views">Views</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Core<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\core\benchmark.html" title="Benchmark">Benchmark</a></li>
				<li><a href="..\core\config.html" title="Config">Config</a></li>
				<li><a href="..\core\event.html" title="Event">Event</a></li>
				<li><a href="..\core\kohana.html" title="Kohana">Kohana</a></li>
				<li><a href="..\core\log.html" title="Log">Log</a></li>
				<li><a href="..\core\utf8.html" title="Unicode">Unicode</a></li>
				<li><a href="..\core\view.html" title="View">View</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Libraries<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\libraries\cache.html" title="Cache">Cache</a></li>
				<li><a href="..\libraries\calendar.html" title="Calendar">Calendar</a></li>
				<li><a href="..\libraries\captcha.html" title="Captcha">Captcha</a></li>
				<li><a href="..\libraries\database.html" title="Database">Database</a></li>
				<li><a href="..\libraries\encrypt.html" title="Encrypt">Encrypt</a></li>
				<li><a href="..\libraries\image.html" title="Image">Image</a></li>
				<li><a href="..\libraries\input.html" title="Input">Input</a></li>
				<li><a href="..\libraries\orm.html" title="ORM">ORM</a></li>
				<li><a href="..\libraries\pagination.html" title="Pagination">Pagination</a></li>
				<li><a href="..\libraries\profiler.html" title="Profiler">Profiler</a></li>
				<li><a href="..\libraries\session.html" title="Session">Session</a></li>
				<li><a href="..\libraries\uri.html" title="URI">URI</a></li>
				<li><a href="..\libraries\validation.html" title="Validation">Validation</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Helpers<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\helpers\arr.html" title="Array">Array</a></li>
				<li><a href="..\helpers\cookie.html" title="Cookie">Cookie</a></li>
				<li><a href="..\helpers\date.html" title="Date">Date</a></li>
				<li><a href="..\helpers\download.html" title="Download">Download</a></li>
				<li><a href="..\helpers\email.html" title="Email">Email</a></li>
				<li><a href="..\helpers\expires.html" title="Expires">Expires</a></li>
				<li><a href="..\helpers\feed.html" title="Feed">Feed</a></li>
				<li><a href="..\helpers\file.html" title="File">File</a></li>
				<li><a href="..\helpers\form.html" title="Form">Form</a></li>
				<li><a href="..\helpers\format.html" title="Format">Format</a></li>
				<li><a href="..\helpers\html.html" title="HTML">HTML</a></li>
				<li><a href="..\helpers\inflector.html" title="Inflector">Inflector</a></li>
				<li><a href="..\helpers\num.html" title="Num">Num</a></li>
				<li><a href="..\helpers\remote.html" title="Remote">Remote</a></li>
				<li><a href="..\helpers\request.html" title="Request">Request</a></li>
				<li><a href="..\helpers\security.html" title="Security">Security</a></li>
				<li><a href="..\helpers\text.html" title="Text">Text</a></li>
				<li><a href="..\helpers\upload.html" title="Upload">Upload</a></li>
				<li><a href="..\helpers\url.html" title="URL">URL</a></li>
				<li><a href="..\helpers\valid.html" title="Valid">Valid</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


</ul></div>


<!-- Start Body -->
<div id="body" class="dokuwiki clearfix">

<!-- wikipage start -->
<!-- TOC START -->
<!-- TOC END -->
<table class="inline"><tr class="row0"><th class="col0">Status</th><td class="col1">Draft</td>
	</tr><tr class="row1"><th class="col0">Todo</th><td class="col1">sub-folders, method parameters, remapping example, Proof read</td>
	</tr></table><h1><a name="controllers" id="controllers">Controllers</a></h1>
<div class="level1">

<p>

Controllers stand in between the models and the views in an application. They pass information on to the model when data needs to be changed and they request information from the model. For example  database inserts, updates and deletes for data change and database selects for information retrieval. 
Controllers pass on the information of the model to the views, the views contain the final output for the users.
</p>

<p>
Controllers are called by a <acronym title="Uniform Resource Locator">URL</acronym>, see <a href="urls.html" class="wikilink1" title="general:urls">Urls</a> for more information.
</p>

</div>

<h2><a name="controller_naming_and_anatomy" id="controller_naming_and_anatomy">Controller naming and anatomy</a></h2>
<div class="level2">

<p>

A controller's filename can be basically anything. The name of the controller class must correspond to the filename. 
</p>

<p>
<strong>Conventions for a controller</strong>
</p>
<ul><li class="level1"><div class="li"> must reside in a <code>controllers</code> (sub-)directory </div>
</li>
<li class="level1"><div class="li"> controller filename must be lowercase, e.g. <code>articles.php</code></div>
</li>
<li class="level1"><div class="li"> controller class must map to filename and capitalized, and must be appended with <strong>_Controller</strong>, e.g. <strong>Articles_Controller</strong></div>
</li>
<li class="level1"><div class="li"> must have the Controller class as (grand)parent</div>
</li>
<li class="level1"><div class="li"> controller methods preceded by '_' (e.g. <strong>_do_something</strong>() ) cannot be called by the <acronym title="Uniform Resource Identifier">URI</acronym> mapping</div>
</li>
</ul></div>

<h3><a name="a_simple_controller" id="a_simple_controller">A simple controller</a></h3>
<div class="level3">

<p>
We start with a simple controller. It will show Hello World on the screen.
</p>

<p>
<strong>application/controllers/article.php</strong>

</p>
<pre class="code php"><span class="kw2">class</span> Article_Controller <span class="kw2">extends</span> Controller
<span class="br0">{</span>
    <span class="kw2">public</span> <span class="kw2">function</span> index<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Hello World!'</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>

Now if you enter yoursite.com/article (or yoursite.com/index.php/article without <acronym title="Uniform Resource Locator">URL</acronym> rewritting) you should see
</p>
<pre class="code">Hello World</pre>
<p>
That's it, your first controller. You can see all conventions are applied.
</p>

</div>

<h3><a name="more_advanced_controller" id="more_advanced_controller">More advanced controller</a></h3>
<div class="level3">

<p>
In the example above the <code>index()</code> method is called by the yoursite.com/article url. If the second segment of the url is empty, the index method is called. It would also be called by the following url: yoursite.com/article/index
</p>

<p>
<em class="u">If the second segment of the url is not empty, it determines which method of the controller is called.</em> 
</p>

<p>

<strong>application/controllers/article.php</strong>

</p>
<pre class="code php"><span class="kw2">class</span> Article_Controller <span class="kw2">extends</span> Controller
<span class="br0">{</span>
    <span class="kw2">public</span> <span class="kw2">function</span> index<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Hello World!'</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> overview<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Article list goes here!'</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>

Now if you call the url yoursite.com/article/overview it will display 
</p>
<pre class="code">Article list goes here!</pre>
</div>

<h3><a name="controller_with_arguments" id="controller_with_arguments">Controller with arguments</a></h3>
<div class="level3">

<p>
Say we want to display a specific article, for example the article with the title being <code>your-article-title</code> and the id of the article is <code>1</code>. 
</p>

<p>
The url would look like yoursite.com/article/view/<strong>your-article-title</strong>/<strong>1</strong> The last two segments of the url are passed on to the view() method. 
</p>

<p>
<strong>application/controllers/article.php</strong>

</p>
<pre class="code php"><span class="kw2">class</span> Article_Controller <span class="kw2">extends</span> Controller
<span class="br0">{</span>
    <span class="kw2">public</span> <span class="kw2">function</span> index<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Hello World!'</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> overview<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Article list goes here!'</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> view<span class="br0">(</span><span class="re1">$title</span><span class="sy0">,</span><span class="re1">$id</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="re1">$id</span> <span class="sy0">.</span> <span class="st0">' - '</span> <span class="sy0">.</span> <span class="re1">$title</span><span class="sy0">;</span>
        <span class="co1">// you'd retrieve the article from the database here normally</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>

When you call yoursite.com/article/view/<strong>your-article-title</strong>/<strong>1</strong> it will display 
</p>
<pre class="code">1 - your-article-title</pre>
</div>

<h2><a name="controllers_and_subdirectories" id="controllers_and_subdirectories">Controllers and subdirectories</a></h2>
<div class="level2">

<p>
If you put a controller in a subdirectory of the /controllers/ directory, Kohana will include the subdirectory in the mapping to the controller. E.g. a file in <code>application/controllers/admin/user.php</code> will correspond to the url <a href="http://localhost/admin/user" class="urlextern" title="http://localhost/admin/user" rel="nofollow">http://localhost/admin/user</a>
</p>

</div>

<h2><a name="routing_controllers_elsewhere" id="routing_controllers_elsewhere">Routing controllers elsewhere</a></h2>
<div class="level2">

<p>
If for some reason the mapping from the <acronym title="Uniform Resource Identifier">URI</acronym> to the controller and method is not right for you you can use routing to map a <acronym title="Uniform Resource Identifier">URI</acronym> to another controller.
E.g. have <code>localhost/about/me</code> map to <a href="http://localhost/articles/view/1" class="urlextern" title="http://localhost/articles/view/1" rel="nofollow">http://localhost/articles/view/1</a> 
</p>

<p>
See <a href="routing.html" class="wikilink1" title="general:routing">Routing</a> for more information on this.
</p>

</div>

<h2><a name="special_methods" id="special_methods">Special methods</a></h2>
<div class="level2">

</div>

<h3><a name="construct" id="construct">__construct</a></h3>
<div class="level3">

<p>

If you declare a constructor in your controller, for example to load some resources for the entire controller, you have to call the parent constructor.
</p>

<p>
<strong>application/controllers/article.php</strong>
</p>
<pre class="code php"><span class="kw2">class</span> Article_Controller <span class="kw2">extends</span> Controller
<span class="br0">{</span>
    protected <span class="re1">$db</span><span class="sy0">;</span>
    protected <span class="re1">$session</span><span class="sy0">;</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// This must be included</span>
 
        <span class="re1">$this</span><span class="sy0">-&gt;</span><span class="me1">db</span> <span class="sy0">=</span> Database<span class="sy0">::</span><span class="me2">instance</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="re1">$this</span><span class="sy0">-&gt;</span><span class="me1">session</span> <span class="sy0">=</span> Session<span class="sy0">::</span><span class="me2">instance</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> index<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="re1">$this</span><span class="sy0">-&gt;</span><span class="me1">session</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="st0">'user_id'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> view<span class="br0">(</span><span class="re1">$article_id</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="re1">$article</span> <span class="sy0">=</span> <span class="re1">$this</span><span class="sy0">-&gt;</span><span class="me1">db</span><span class="sy0">-&gt;</span><span class="me1">getwhere</span><span class="br0">(</span><span class="st0">'articles'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="br0">(</span>int<span class="br0">)</span> <span class="re1">$article_id</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>
This example also shows how you can retrieve an article from the database using <acronym title="Uniform Resource Locator">URL</acronym> segments. If you call <code>yoursite.com/article/view/5</code>, it will retrieve the article whose <code>id</code> is <code>5</code>.
</p>

</div>

<h3><a name="index" id="index">index</a></h3>
<div class="level3">

<p>

<code>index()</code> is the method that will be called by default, when no method segment is provided in the <acronym title="Uniform Resource Locator">URL</acronym>.
E.g. if your controller is called <code>Welcome_Controller</code>, and the <acronym title="Uniform Resource Locator">URL</acronym> is <a href="http://yoursite.com/welcome" class="urlextern" title="http://yoursite.com/welcome" rel="nofollow">http://yoursite.com/welcome</a> then the <code>index</code> method is called.
</p>

<p>
Note: You cannot pass arguments to an index method, unless the <acronym title="Uniform Resource Identifier">URI</acronym> contains <strong>index</strong> in segment two. 
</p>

</div>

<h3><a name="call" id="call">__call</a></h3>
<div class="level3">

<p>

<code>__call($method, $arguments)</code> is the method called when a method of a controller is called that doesn't exist. It is declared in the Controller class and will trigger a 404 by default. You can override this method in your own controllers for advanced functionality.
</p>

<p>
 
<strong>application/controllers/article.php</strong>

</p>
<pre class="code php"><span class="kw2">class</span> Article_Controller <span class="kw2">extends</span> Controller
<span class="br0">{</span>
    <span class="kw2">public</span> <span class="kw2">function</span> __call<span class="br0">(</span><span class="re1">$method</span><span class="sy0">,</span><span class="re1">$arguments</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="re1">$id</span><span class="sy0">=</span><span class="br0">(</span>int<span class="br0">)</span> <span class="re1">$method</span><span class="sy0">;</span>
        <span class="re1">$this</span><span class="sy0">-&gt;</span><span class="me1">view</span><span class="br0">(</span><span class="re1">$id</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> view<span class="br0">(</span><span class="re1">$id</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="re1">$id</span><span class="sy0">;</span>
        <span class="co1">// you'd retrieve the article from the database here normally</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>

When you call yoursite.com/article/<strong>1</strong> , it will display the article. You see that the second segment now is the <code>$id</code> instead of the controller method.
</p>

</div>

<h3><a name="private_methods" id="private_methods">Private methods</a></h3>
<div class="level3">

<p>
Sometimes you want some methods in your controller which should not be available on your website. They are only used internally. This can be done by declaring methods private and/or prepending them with <strong>_</strong>
</p>

<p>
<strong>application/controllers/article.php</strong>

</p>
<pre class="code php"><span class="kw2">class</span> Article_Controller <span class="kw2">extends</span> Controller
<span class="br0">{</span>
    <span class="kw2">public</span> <span class="kw2">function</span> index<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Hello World!'</span><span class="sy0">;</span>
    <span class="br0">}</span>
 
    <span class="kw2">private</span> <span class="kw2">function</span> _article_form<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <a href="http://www.php.net/echo"><span class="kw3">echo</span></a> <span class="st0">'Article form'</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>

When you call yoursite.com/article/_article_form you'll encounter a 404.
</p>

</div>

<h2><a name="special_controllers" id="special_controllers">Special Controllers</a></h2>
<div class="level2">

</div>

<h3><a name="using_a_base_controller_for_your_application" id="using_a_base_controller_for_your_application">Using a base controller for your application</a></h3>
<div class="level3">

<p>
Using a base controller for your application can be very helpful. You can execute code on every page for example, useful for authenticating and authorizing users for example or doing session magic.
</p>

<p>
<strong>Example</strong> <code>MY_Controller.php</code>

</p>
<pre class="code php"><span class="kw2">&lt;?php</span>
 
<span class="kw2">class</span> Controller <span class="kw2">extends</span> Controller_Core
<span class="br0">{</span>
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        parent<span class="sy0">::</span>__construct<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
        <span class="co1">// authentication goes here for example</span>
    <span class="br0">}</span>
 
    <span class="kw2">public</span> <span class="kw2">function</span> do_something<span class="br0">(</span><span class="br0">)</span>
    <span class="br0">{</span>
        <span class="co1">// method available in all controllers</span>
    <span class="br0">}</span>
<span class="br0">}</span></pre>
<p>

The file should be named <code>MY_Controller.php</code> It should then be placed in <code>application/libraries</code> This class has all the methods of the original Controller plus your own. 
</p>

<p>
Note: The prefix <strong>MY_</strong> can be configured in <code>application/config/config.php</code> by changing the <strong>$config['extension_prefix']</strong>

</p>

</div>

<!-- wikipage stop -->

</div>
<!-- End Body -->


<div id="wikibar" class="clearfix">
	<div class="meta">
		<div class="user">
					</div>
		<div class="doc">
			general/controllers.txt · Last modified: 2008/11/02 15:03 by coolfactor			 
		</div>
	</div>

	</div>

<div id="footer"><strong>©2007-2008 Kohana Team. All rights reserved.</strong></div>


<div class="no"><img src="/lib/exe/indexer.php?id=general%3Acontrollers&amp;1229410964" width="1" height="1" alt=""></div>
</body></html>

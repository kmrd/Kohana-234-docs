<html xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>
    libraries:database:cache    [Kohana User Guide]
</title><meta name="generator" content="DokuWiki Release 2008-05-05"><meta name="robots" content="index,follow"><meta name="date" content="2008-05-01T20:31:13-0500"><meta name="keywords" content="libraries,database,cache"><link rel="search" type="application/opensearchdescription+xml" href="..\..\lib\exe\opensearch.html" title="Kohana User Guide"><link rel="start" href="/"><link rel="contents" href="cache-1.html?do=index" title="Index"><link rel="alternate" type="application/rss+xml" title="Recent Changes" href="..\..\feed.html"><link rel="alternate" type="application/rss+xml" title="Current Namespace" href="..\..\feed-11.html?mode=list&amp;ns=libraries:database"><link rel="alternate" type="text/html" title="Plain HTML" href="..\..\_export\xhtml\libraries\database\cache.html"><link rel="alternate" type="text/plain" title="Wiki Markup" href="..\..\_export\raw\libraries\database\cache.html"><link rel="stylesheet" media="all" type="text/css" href="..\..\_css\all.css"><link rel="stylesheet" media="screen" type="text/css" href="..\..\_css\kohana.css"><link rel="stylesheet" media="print" type="text/css" href="..\..\_css\print.css"><script type="text/javascript" charset="utf-8" src="..\..\_js\script.js"></script><link rel="shortcut icon" href="..\..\lib\tpl\kohana\images\favicon.html"><link rel="stylesheet" type="text/css" href="..\..\_css\my.css"></head><body>
<!-- Start Header -->
<div id="header">

<!-- Start Logo -->
<a id="logo" href="..\contents.html"><img src="..\..\_img\kohana.png" alt="Kohana"></a>
<!-- End Logo -->

</div>
<!-- End Header -->

<div class="menu clearfix">
<ul><li class="top active"><a href="..\contents.html">Contents</a></li>


<li class="top"><a href="..\contents.html">General<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\..\general\configuration.html" title="Configuration">Configuration</a></li>
				<li><a href="..\..\general\controllers.html" title="Controllers">Controllers</a></li>
				<li><a href="..\..\general\errorhandling.html" title="Error Handling">Error Handling</a></li>
				<li><a href="..\..\general\events.html" title="Events">Events</a></li>
				<li><a href="..\..\general\filesystem.html" title="Filesystem">Filesystem</a></li>
				<li><a href="..\..\general\helpers.html" title="Helpers">Helpers</a></li>
				<li><a href="..\..\general\hooks.html" title="Hooks">Hooks</a></li>
				<li><a href="..\..\general\i18n.html" title="Internationalization">Internationalization</a></li>
				<li><a href="..\..\general\libraries.html" title="Libraries">Libraries</a></li>
				<li><a href="..\..\general\loading.html" title="Loading">Loading</a></li>
				<li><a href="..\..\general\logging.html" title="Logging">Logging</a></li>
				<li><a href="..\..\general\models.html" title="Models">Models</a></li>
				<li><a href="..\..\general\modules.html" title="Modules">Modules</a></li>
				<li><a href="..\..\general\routing.html" title="Routing">Routing</a></li>
				<li><a href="..\..\general\urls.html" title="URLs">URLs</a></li>
				<li><a href="..\..\general\views.html" title="Views">Views</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Core<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\core\benchmark.html" title="Benchmark">Benchmark</a></li>
				<li><a href="..\core\config.html" title="Config">Config</a></li>
				<li><a href="..\core\event.html" title="Event">Event</a></li>
				<li><a href="..\core\kohana.html" title="Kohana">Kohana</a></li>
				<li><a href="..\core\log.html" title="Log">Log</a></li>
				<li><a href="..\core\utf8.html" title="Unicode">Unicode</a></li>
				<li><a href="..\core\view.html" title="View">View</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Libraries<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\cache.html" title="Cache">Cache</a></li>
				<li><a href="..\calendar.html" title="Calendar">Calendar</a></li>
				<li><a href="..\captcha.html" title="Captcha">Captcha</a></li>
				<li><a href="..\database.html" title="Database">Database</a></li>
				<li><a href="..\encrypt.html" title="Encrypt">Encrypt</a></li>
				<li><a href="..\image.html" title="Image">Image</a></li>
				<li><a href="..\input.html" title="Input">Input</a></li>
				<li><a href="..\orm.html" title="ORM">ORM</a></li>
				<li><a href="..\pagination.html" title="Pagination">Pagination</a></li>
				<li><a href="..\profiler.html" title="Profiler">Profiler</a></li>
				<li><a href="..\session.html" title="Session">Session</a></li>
				<li><a href="..\uri.html" title="URI">URI</a></li>
				<li><a href="..\validation.html" title="Validation">Validation</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Helpers<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\..\helpers\arr.html" title="Array">Array</a></li>
				<li><a href="..\..\helpers\cookie.html" title="Cookie">Cookie</a></li>
				<li><a href="..\..\helpers\date.html" title="Date">Date</a></li>
				<li><a href="..\..\helpers\download.html" title="Download">Download</a></li>
				<li><a href="..\..\helpers\email.html" title="Email">Email</a></li>
				<li><a href="..\..\helpers\expires.html" title="Expires">Expires</a></li>
				<li><a href="..\..\helpers\feed.html" title="Feed">Feed</a></li>
				<li><a href="..\..\helpers\file.html" title="File">File</a></li>
				<li><a href="..\..\helpers\form.html" title="Form">Form</a></li>
				<li><a href="..\..\helpers\format.html" title="Format">Format</a></li>
				<li><a href="..\..\helpers\html.html" title="HTML">HTML</a></li>
				<li><a href="..\..\helpers\inflector.html" title="Inflector">Inflector</a></li>
				<li><a href="..\..\helpers\num.html" title="Num">Num</a></li>
				<li><a href="..\..\helpers\remote.html" title="Remote">Remote</a></li>
				<li><a href="..\..\helpers\request.html" title="Request">Request</a></li>
				<li><a href="..\..\helpers\security.html" title="Security">Security</a></li>
				<li><a href="..\..\helpers\text.html" title="Text">Text</a></li>
				<li><a href="..\..\helpers\upload.html" title="Upload">Upload</a></li>
				<li><a href="..\..\helpers\url.html" title="URL">URL</a></li>
				<li><a href="..\..\helpers\valid.html" title="Valid">Valid</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


</ul></div>


<!-- Start Body -->
<div id="body" class="dokuwiki clearfix">

<!-- wikipage start -->
<table class="inline"><tr class="row0"><th class="col0">Status</th><td class="col1">Draft</td>
	</tr><tr class="row1"><th class="col0">Todo</th><td class="col1">Needs Review</td>
	</tr></table><h1><a name="database_query_caching" id="database_query_caching">Database Query Caching</a></h1>
<div class="level1">

<p>

Query caching allows for speed improvements when multiple, identical queries are run. It caches the results of all queries, so when the next one is run, it uses that cache result instead of querying the database again. Please note that this is only useful for SELECT statements, and INSERT or UPDATE statements may corrupt your cache results.
</p>

<p>
It works automatically when you have the config option set, and only has one method associated with it.
</p>

<p>
Please note that this is not a substitute for properly designing your application. Generally this is only needed on very large applications where hundreds of queries are called and it's (nearly) impossible to properly optimize them all.
</p>

</div>

<h3><a name="clear_cache" id="clear_cache">clear_cache()</a></h3>
<div class="level3">

<p>

This method clears the database cache. If you pass an <acronym title="Structured Query Language">SQL</acronym> statement as a string parameter, it will only clear the cache for that statement. If you pass <code>TRUE</code> as a parameter, it will clear the cache for the last run statement, equivalent to <code>$db→clear_cache($db→last_query())</code>.
</p>
<pre class="code php"><span class="re1">$db</span> <span class="sy0">=</span> <span class="kw2">new</span> Database<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="re1">$query</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'records'</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'foobar'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// Work with the results...</span>
 
<span class="sy0">...</span>
 
<span class="co1">// Now somewhere else I need to run the same query:</span>
<span class="re1">$query2</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'records'</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'foobar'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// This will grab the results from my cache!</span>
 
<span class="sy0">...</span>
 
<span class="re1">$status</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">insert</span><span class="br0">(</span><span class="st0">'records'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">10</span><span class="sy0">,</span> <span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'foobar'</span><span class="sy0">,</span> <span class="st0">'content'</span> <span class="sy0">=&gt;</span> <span class="st0">'foobar'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// Now I inserted a row that has corrupted the cache. I need to clear it before I run the same query:</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">clear_cache</span><span class="br0">(</span><span class="kw2">TRUE</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Same as $db-&gt;clear_cache($db-&gt;last_query());</span>
 
OR
 
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">clear_cache</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// This clears the whole cache.</span>
 
<span class="co1">//Now I can safely run my query again.</span>
<span class="re1">$query3</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'records'</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'foobar'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// New results returned and set to my cache.</span></pre>
</div>

<!-- wikipage stop -->

</div>
<!-- End Body -->


<div id="wikibar" class="clearfix">
	<div class="meta">
		<div class="user">
					</div>
		<div class="doc">
			libraries/database/cache.txt · Last modified: 2008/05/01 20:31 (external edit)			 
		</div>
	</div>

	</div>

<div id="footer"><strong>©2007-2008 Kohana Team. All rights reserved.</strong></div>


<div class="no"><img src="/lib/exe/indexer.php?id=libraries%3Adatabase%3Acache&amp;1229411556" width="1" height="1" alt=""></div>
</body></html>

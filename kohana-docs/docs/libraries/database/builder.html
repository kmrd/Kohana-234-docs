<html xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>
    libraries:database:builder    [Kohana User Guide]
</title><meta name="generator" content="DokuWiki Release 2008-05-05"><meta name="robots" content="index,follow"><meta name="date" content="2008-10-31T15:19:51-0500"><meta name="keywords" content="libraries,database,builder"><link rel="search" type="application/opensearchdescription+xml" href="..\..\lib\exe\opensearch.html" title="Kohana User Guide"><link rel="start" href="/"><link rel="contents" href="builder-1.html?do=index" title="Index"><link rel="alternate" type="application/rss+xml" title="Recent Changes" href="..\..\feed.html"><link rel="alternate" type="application/rss+xml" title="Current Namespace" href="..\..\feed-11.html?mode=list&amp;ns=libraries:database"><link rel="alternate" type="text/html" title="Plain HTML" href="..\..\_export\xhtml\libraries\database\builder.html"><link rel="alternate" type="text/plain" title="Wiki Markup" href="..\..\_export\raw\libraries\database\builder.html"><link rel="stylesheet" media="all" type="text/css" href="..\..\_css\all.css"><link rel="stylesheet" media="screen" type="text/css" href="..\..\_css\kohana.css"><link rel="stylesheet" media="print" type="text/css" href="..\..\_css\print.css"><script type="text/javascript" charset="utf-8" src="..\..\_js\script.js"></script><link rel="shortcut icon" href="..\..\lib\tpl\kohana\images\favicon.html"><link rel="stylesheet" type="text/css" href="..\..\_css\my.css"></head><body>
<!-- Start Header -->
<div id="header">

<!-- Start Logo -->
<a id="logo" href="..\contents.html"><img src="..\..\_img\kohana.png" alt="Kohana"></a>
<!-- End Logo -->

</div>
<!-- End Header -->

<div class="menu clearfix">
<ul><li class="top active"><a href="..\contents.html">Contents</a></li>


<li class="top"><a href="..\contents.html">General<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\..\general\configuration.html" title="Configuration">Configuration</a></li>
				<li><a href="..\..\general\controllers.html" title="Controllers">Controllers</a></li>
				<li><a href="..\..\general\errorhandling.html" title="Error Handling">Error Handling</a></li>
				<li><a href="..\..\general\events.html" title="Events">Events</a></li>
				<li><a href="..\..\general\filesystem.html" title="Filesystem">Filesystem</a></li>
				<li><a href="..\..\general\helpers.html" title="Helpers">Helpers</a></li>
				<li><a href="..\..\general\hooks.html" title="Hooks">Hooks</a></li>
				<li><a href="..\..\general\i18n.html" title="Internationalization">Internationalization</a></li>
				<li><a href="..\..\general\libraries.html" title="Libraries">Libraries</a></li>
				<li><a href="..\..\general\loading.html" title="Loading">Loading</a></li>
				<li><a href="..\..\general\logging.html" title="Logging">Logging</a></li>
				<li><a href="..\..\general\models.html" title="Models">Models</a></li>
				<li><a href="..\..\general\modules.html" title="Modules">Modules</a></li>
				<li><a href="..\..\general\routing.html" title="Routing">Routing</a></li>
				<li><a href="..\..\general\urls.html" title="URLs">URLs</a></li>
				<li><a href="..\..\general\views.html" title="Views">Views</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Core<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\core\benchmark.html" title="Benchmark">Benchmark</a></li>
				<li><a href="..\core\config.html" title="Config">Config</a></li>
				<li><a href="..\core\event.html" title="Event">Event</a></li>
				<li><a href="..\core\kohana.html" title="Kohana">Kohana</a></li>
				<li><a href="..\core\log.html" title="Log">Log</a></li>
				<li><a href="..\core\utf8.html" title="Unicode">Unicode</a></li>
				<li><a href="..\core\view.html" title="View">View</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Libraries<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\cache.html" title="Cache">Cache</a></li>
				<li><a href="..\calendar.html" title="Calendar">Calendar</a></li>
				<li><a href="..\captcha.html" title="Captcha">Captcha</a></li>
				<li><a href="..\database.html" title="Database">Database</a></li>
				<li><a href="..\encrypt.html" title="Encrypt">Encrypt</a></li>
				<li><a href="..\image.html" title="Image">Image</a></li>
				<li><a href="..\input.html" title="Input">Input</a></li>
				<li><a href="..\orm.html" title="ORM">ORM</a></li>
				<li><a href="..\pagination.html" title="Pagination">Pagination</a></li>
				<li><a href="..\profiler.html" title="Profiler">Profiler</a></li>
				<li><a href="..\session.html" title="Session">Session</a></li>
				<li><a href="..\uri.html" title="URI">URI</a></li>
				<li><a href="..\validation.html" title="Validation">Validation</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


<li class="top"><a href="..\contents.html">Helpers<!--[if IE 7]><!--></a><!--<![endif]-->
<!--[if lte IE 6]><table><tr><td><![endif]-->
	<ul><li><a href="..\..\helpers\arr.html" title="Array">Array</a></li>
				<li><a href="..\..\helpers\cookie.html" title="Cookie">Cookie</a></li>
				<li><a href="..\..\helpers\date.html" title="Date">Date</a></li>
				<li><a href="..\..\helpers\download.html" title="Download">Download</a></li>
				<li><a href="..\..\helpers\email.html" title="Email">Email</a></li>
				<li><a href="..\..\helpers\expires.html" title="Expires">Expires</a></li>
				<li><a href="..\..\helpers\feed.html" title="Feed">Feed</a></li>
				<li><a href="..\..\helpers\file.html" title="File">File</a></li>
				<li><a href="..\..\helpers\form.html" title="Form">Form</a></li>
				<li><a href="..\..\helpers\format.html" title="Format">Format</a></li>
				<li><a href="..\..\helpers\html.html" title="HTML">HTML</a></li>
				<li><a href="..\..\helpers\inflector.html" title="Inflector">Inflector</a></li>
				<li><a href="..\..\helpers\num.html" title="Num">Num</a></li>
				<li><a href="..\..\helpers\remote.html" title="Remote">Remote</a></li>
				<li><a href="..\..\helpers\request.html" title="Request">Request</a></li>
				<li><a href="..\..\helpers\security.html" title="Security">Security</a></li>
				<li><a href="..\..\helpers\text.html" title="Text">Text</a></li>
				<li><a href="..\..\helpers\upload.html" title="Upload">Upload</a></li>
				<li><a href="..\..\helpers\url.html" title="URL">URL</a></li>
				<li><a href="..\..\helpers\valid.html" title="Valid">Valid</a></li>
			</ul><!--[if lte IE 6]></td></tr></table></a><![endif]--></li>


</ul></div>


<!-- Start Body -->
<div id="body" class="dokuwiki clearfix">

<!-- wikipage start -->
<!-- TOC START -->
<!-- TOC END -->
<table class="inline"><tr class="row0"><th class="col0">Status</th><td class="col1">Draft</td>
	</tr><tr class="row1"><th class="col0">Todo</th><td class="col1">Expand, check database.php to see if everything is documented</td>
	</tr></table><h1><a name="database_query_builder" id="database_query_builder">Database Query Builder</a></h1>
<div class="level1">

<p>

Use the query builder methods to make database agnostic queries and data manipulation.
</p>

</div>

<h2><a name="limitations" id="limitations">Limitations</a></h2>
<div class="level2">

<p>

While the query builder portion of the database library is very powerful and easy to use, it does have some inherent limitations. This is mainly due to the fact it escapes everything you give it. Therefore the following things won't work as expected:

</p>
<ol><li class="level1"><div class="li"> Database arithmetic: <code>$db→update('pages', array('views' ⇒ 'views+1'))</code>. This will get escaped and not work as expected.</div>
</li>
<li class="level1"><div class="li"> Parenthesis support: queries like <code>SELECT * FROM pages WHERE (id = 5) OR (title = “BLAH” AND id = 15)</code> won't work properly, because the query builder doesn't yet have the capability to add parentheses. This is a planned addition in a future release.</div>
</li>
<li class="level1"><div class="li"> Any database specific functions: things like MySQL's <code>NOW()</code> function will get escaped and not work properly. In future releases there may be an option to turn off automatic query escaping, which will solve this problem. The are a couple reasons we won't support this right now:</div>
</li>
</ol><ul><li class="level1"><div class="li"> The query builder is supposed to provide server agnostic database access. Putting DB specific functions in your query builder statement completely destroys this.</div>
</li>
<li class="level1"><div class="li"> There are entirely too many functions to support for every database server, and check every call against all these possible functions. We focus on speed, sometimes at the cost of functionality.</div>
</li>
<li class="level1"><div class="li"> Quoting is necessary to allow maximum flexibility for table/column names</div>
</li>
</ul></div>

<h2><a name="methods" id="methods">Methods</a></h2>
<div class="level2">

</div>

<h3><a name="select" id="select">select()</a></h3>
<div class="level3">

<p>

The select() method set the table column names you want to SELECT with your query.
</p>
<pre class="code php"><span class="re1">$db</span> <span class="sy0">=</span> <span class="kw2">new</span> Database<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">select</span><span class="br0">(</span><span class="st0">'id, title'</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
This will set the SELECT part of your query to `id`, `title`. Note that the query builder automatically escapes column names for you, and if you leave this method out, your query will automatically be set to “SELECT *”. You can also specify cross table columns:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">select</span><span class="br0">(</span><span class="st0">'users.id, pages.title'</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
And it will generate “SELECT `users`.`id`, `pages`.`title`”.
</p>

<p>
You can also specify column aliases:

</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">select</span><span class="br0">(</span><span class="st0">'id as page_id'</span><span class="sy0">,</span> <span class="st0">'title as page_title'</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
Will generate SELECT `id` AS `page_id`, `title` AS `page_title`
</p>

<p>
For getting DISTINCT data:

</p>
<pre class="code">$db-&gt;select('DISTINCT user')</pre>
<p>

Will generate SELECT DISTINCT  `user`.
</p>

</div>

<h3><a name="from" id="from">from()</a></h3>
<div class="level3">

<p>

The <code>from()</code> method sets the table(s) you want to SELECT from. You can use an array or comma separated list of table names.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'pages'</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// OR</span>
 
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'pages'</span><span class="sy0">,</span> <span class="st0">'users'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>

This will produce “FROM `pages`, `users`”. Note that the query builder automatically escapes your input.
</p>

<p>
You can also specify table aliases like with select() above.
</p>

</div>

<h3><a name="where" id="where">where()</a></h3>
<div class="level3">

<p>

The <code>where()</code> method sets the where conditions of your query. You can pass it a key string along with a value string, or an array containing multiple key/value pairs. It will join them with AND
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><span class="st0">'id'</span><span class="sy0">,</span> <span class="nu0">5</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="sy0">,</span> <span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
The last line will generate “WHERE `id` = 5 AND `title` = “Demo””.
</p>

</div>

<h4><a name="where_not" id="where_not">where not</a></h4>
<div class="level4">
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id!='</span><span class="sy0">=&gt;</span><span class="re1">$some_id</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="orwhere" id="orwhere">orwhere()</a></h3>
<div class="level3">

<p>

Identical to the above method, except it joins multiple parts with OR.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">orwhere</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="sy0">,</span> <span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
The last line will generate “WHERE `id` = 5 OR `title` = “Demo””.
</p>

</div>

<h3><a name="like" id="like">like()</a></h3>
<div class="level3">

<p>

Identical to where(), except it makes a LIKE string:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">like</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'Demo'</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
This generates “WHERE `title` LIKE ”%Demo%””; You can manually specify %'s to do the query you want. For this don't forget to specify FALSE as a third parameter:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">like</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'%Demo'</span><span class="sy0">,</span> <span class="kw2">FALSE</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">like</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'Demo%'</span><span class="sy0">,</span> <span class="kw2">FALSE</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
You can also pass an array containing multiple key/value pairs. It will join them with AND:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">like</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="sy0">,</span> <span class="st0">'subtitle'</span> <span class="sy0">=&gt;</span> <span class="st0">'Start'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
This generates “WHERE `title` LIKE ”%Demo%” AND `subtitle` LIKE ”%Start%””.
</p>

</div>

<h3><a name="orlike" id="orlike">orlike()</a></h3>
<div class="level3">

<p>

Identical to like(), except it joins multiple parts with OR:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">orlike</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="sy0">,</span> <span class="st0">'subtitle'</span> <span class="sy0">=&gt;</span> <span class="st0">'Start'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
This generates “WHERE `title` LIKE ”%Demo%” OR `subtitle` LIKE ”%Start%””.
</p>

</div>

<h3><a name="notlike" id="notlike">notlike()</a></h3>
<div class="level3">

<p>

Identical to like(), except it generates a NOT LIKE clause.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">notlike</span><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// generates "WHERE `title` NOT LIKE "%Demo%""</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">notlike</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="sy0">,</span> <span class="st0">'subtitle'</span> <span class="sy0">=&gt;</span> <span class="st0">'Start'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// generates "WHERE `title` NOT LIKE "%Demo%" AND `subtitle` NOT LIKE "%Start%""</span></pre>
</div>

<h3><a name="ornotlike" id="ornotlike">ornotlike()</a></h3>
<div class="level3">

<p>

Identical to like(), except it generates an OR NOT LIKE clause.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">ornotlike</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo'</span><span class="sy0">,</span> <span class="st0">'subtitle'</span> <span class="sy0">=&gt;</span> <span class="st0">'Start'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span> <span class="co1">// generates "WHERE `title` NOT LIKE "%Demo%" OR `subtitle` NOT LIKE "%Start%""</span></pre>
</div>

<h3><a name="in" id="in">in()</a></h3>
<div class="level3">

<p>

Creates an IN portion of a query. It has three parameters:

</p>
<ol><li class="level1"><div class="li"> the column to match</div>
</li>
<li class="level1"><div class="li"> an array or string of values to match against</div>
</li>
<li class="level1"><div class="li"> (boolean), to create a NOT clause instead</div>
</li>
</ol><pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">in</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">3</span><span class="sy0">,</span><span class="nu0">4</span><span class="sy0">,</span><span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
This generates “`title` IN ('1','2','3','4','5')”
</p>

</div>

<h3><a name="notin" id="notin">notin()</a></h3>
<div class="level3">

<p>

Identical to in(), except it generates a NOT IN clause. You can either use this method (two parameters), or in() with the third parameter as TRUE.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">notin</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">3</span><span class="sy0">,</span><span class="nu0">4</span><span class="sy0">,</span><span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
<span class="co1">// or</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">in</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">3</span><span class="sy0">,</span><span class="nu0">4</span><span class="sy0">,</span><span class="nu0">5</span><span class="br0">)</span><span class="sy0">,</span> <span class="kw2">TRUE</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
This generates “`title` NOT IN ('1','2','3','4','5')”
</p>

</div>

<h3><a name="regex" id="regex">regex()</a></h3>
<div class="level3">

<p>

This method allows you to search based on a regular expression. It's syntax is identical to like().
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">regex</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'Demo|Sample'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">regex</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'Demo|Sample'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="orregex" id="orregex">orregex()</a></h3>
<div class="level3">

<p>

Identical to regex() except it joins multiple statements with OR.
</p>

</div>

<h3><a name="notregex" id="notregex">notregex()</a></h3>
<div class="level3">

<p>

Identical to regex() expect it generates a NOT REGEX clause.
</p>

</div>

<h3><a name="ornotregex" id="ornotregex">ornotregex()</a></h3>
<div class="level3">

<p>

Identical to regex() except it generates an OR NOT REGEX clause.
</p>

</div>

<h3><a name="groupby" id="groupby">groupby()</a></h3>
<div class="level3">

<p>

Sets the GROUP BY part of a query. You can pass it a string, or an array.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">groupby</span><span class="br0">(</span><span class="st0">'title'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">groupby</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'id'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="having" id="having">having()</a></h3>
<div class="level3">

<p>

Generates a HAVING clause for a query. Syntax is similar to like().
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">having</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'Demo'</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="orhaving" id="orhaving">orhaving()</a></h3>
<div class="level3">

<p>

Identical to having(), except it puts an OR in between multiples.
</p>

</div>

<h3><a name="get" id="get">get()</a></h3>
<div class="level3">

<p>

Executes the current query builder statement. This methods has 3 parameters:

</p>
<ol><li class="level1"><div class="li"> the table to use</div>
</li>
<li class="level1"><div class="li"> the limit to use</div>
</li>
<li class="level1"><div class="li"> the offset to use if the limit is set</div>
</li>
</ol><p>

This returns a Database <a href="result.html" class="wikilink1" title="libraries:database:result">Result</a> object that you can then work on the results of your query with.
</p>
<pre class="code php"><span class="re1">$query</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'pages'</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id &gt;='</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// This is the same as</span>
<span class="re1">$query</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id &gt;='</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="st0">'pages'</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="getwhere" id="getwhere">getwhere()</a></h3>
<div class="level3">

<p>

Same as above, except the parameters are as follows:

</p>
<ol><li class="level1"><div class="li"> the table to use</div>
</li>
<li class="level1"><div class="li"> the where clause to use</div>
</li>
<li class="level1"><div class="li"> the limit to use</div>
</li>
<li class="level1"><div class="li"> the offset to use if the limit is set</div>
</li>
</ol><p>

So our query from above can be simplified into:

</p>
<pre class="code php"><span class="re1">$query</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">getwhere</span><span class="br0">(</span><span class="st0">'pages'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id &gt;='</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="set" id="set">set()</a></h3>
<div class="level3">

<p>

Creates a SET portion of a query for your inserts. You can pass it either one parameter or two parameters:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">set</span><span class="br0">(</span><span class="st0">'column'</span><span class="sy0">,</span> <span class="st0">'value'</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// OR</span>
 
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">set</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'column'</span> <span class="sy0">=&gt;</span> <span class="st0">'value'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="merge" id="merge">merge()</a></h3>
<div class="level3">

<p>

Performs a merge query. The behavior of this method will change depending on which backend database you are using. In MySQL, for example, the database will search for an existing key, delete that row if it exists, then insert a new row. The syntax is similar to <span class="curid"><a href="builder-2.html#update" class="wikilink1" title="libraries:database:builder">update</a></span>.
</p>

</div>

<h3><a name="insert" id="insert">insert()</a></h3>
<div class="level3">

<p>

Performs a database insert query. This method has 2 parameters:

</p>
<ol><li class="level1"><div class="li"> The table to do the insert on</div>
</li>
<li class="level1"><div class="li"> An associative array of columns and their values</div>
</li>
</ol><pre class="code php"><span class="re1">$status</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">insert</span><span class="br0">(</span><span class="st0">'pages'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'My new title'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// count how many rows were inserted</span>
<span class="re1">$rows</span> <span class="sy0">=</span> <a href="http://www.php.net/count"><span class="kw3">count</span></a><span class="br0">(</span><span class="re1">$status</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
Returns a query result (the same object you get back from <code>Database::query()</code>).
</p>

<p>
You can also omit any parameter if you have set it with another query builder method:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'pages'</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">set</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'My new title'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">insert</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="update" id="update">update()</a></h3>
<div class="level3">

<p>

Performs a database update query. This method has 3 parameters:

</p>
<ol><li class="level1"><div class="li"> The table to do the update on</div>
</li>
<li class="level1"><div class="li"> An associative array of columns and their new values</div>
</li>
<li class="level1"><div class="li"> The where clause to update on. This can either be a string or an associative array. See the where() method for details.</div>
</li>
</ol><pre class="code php"><span class="re1">$status</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">update</span><span class="br0">(</span><span class="st0">'pages'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'My new title'</span><span class="br0">)</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// count how many rows were updated</span>
<span class="re1">$rows</span> <span class="sy0">=</span> <a href="http://www.php.net/count"><span class="kw3">count</span></a><span class="br0">(</span><span class="re1">$status</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
You can also omit any parameter if you have set it with another query builder method:
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'pages'</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">set</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'title'</span> <span class="sy0">=&gt;</span> <span class="st0">'My new title'</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">update</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="delete" id="delete">delete()</a></h3>
<div class="level3">

<p>

Performs a database delete query. This method has 2 parameters:

</p>
<ol><li class="level1"><div class="li"> The table to do the delete on</div>
</li>
<li class="level1"><div class="li"> The where clause to delete on. This can either be a string or an associative array. See the where() method for details.</div>
</li>
</ol><pre class="code php"><span class="re1">$status</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">delete</span><span class="br0">(</span><span class="st0">'pages'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// count how many rows were deleted</span>
<span class="re1">$rows</span> <span class="sy0">=</span> <a href="http://www.php.net/count"><span class="kw3">count</span></a><span class="br0">(</span><span class="re1">$status</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
You can also set the table and where portions with query builder methods as described in insert() and update().
</p>

</div>

<h3><a name="offset" id="offset">offset()</a></h3>
<div class="level3">

<p>

Creates the offset portion of a query. This causes your result set to start at a different starting point.
</p>
<pre class="code php"><span class="co1">// Start the results at position 10</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">offset</span><span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="limit" id="limit">limit()</a></h3>
<div class="level3">

<p>

Creates the limit section of a query. The first parameter is the number of results you want your query to limit to.
</p>

<p>
You can also set the offset with this method as well with the second parameter.
</p>
<pre class="code php"><span class="co1">// Limit the query to 15 results</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">limit</span><span class="br0">(</span><span class="nu0">15</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// OR</span>
 
<span class="co1">// Limit the query to 15 results starting at position 10</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">limit</span><span class="br0">(</span><span class="nu0">15</span><span class="sy0">,</span> <span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="orderby" id="orderby">orderby()</a></h3>
<div class="level3">

<p>

Specifies the return order of your query. Has two parameters:

</p>
<ol><li class="level1"><div class="li"> The column(s) to order by (use an array for multiple columns)</div>
</li>
<li class="level1"><div class="li"> The direction to order the column by (defaults to ASC)</div>
</li>
</ol><pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">orderby</span><span class="br0">(</span><span class="st0">'title'</span><span class="sy0">,</span> <span class="st0">'ASC'</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
You can also return randomly ordered results using the following arguments.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">orderby</span><span class="br0">(</span><span class="kw2">NULL</span><span class="sy0">,</span> <span class="st0">'RAND()'</span><span class="br0">)</span><span class="sy0">;</span></pre>
<p>
The <code>orderby()</code> method also supports ordering by multiple columns if you use an associative array as the argument.
</p>
<pre class="code php"><span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">orderby</span><span class="br0">(</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span> <span class="st0">'id'</span> <span class="sy0">=&gt;</span> <span class="st0">'ASC'</span><span class="sy0">,</span> <span class="st0">'date_created'</span> <span class="sy0">=&gt;</span> <span class="st0">'ASC'</span><span class="br0">)</span> <span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="join" id="join">join()</a></h3>
<div class="level3">

<p>

Joins two tables together.

</p>
<ol><li class="level1"><div class="li"> string - table name to join</div>
</li>
<li class="level1"><div class="li"> string/array - where key or array of key ⇒ value pairs</div>
</li>
<li class="level1"><div class="li"> string - where value</div>
</li>
<li class="level1"><div class="li"> string - type of join - LEFT, RIGHT, OUTER, INNER, LEFT OUTER, RIGHT OUTER</div>
</li>
</ol><pre class="code php"><span class="co1">// Run query against the (user_roles) table.</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">(</span><span class="st0">'users_roles'</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// Join the roles with (user_roles)</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">join</span><span class="br0">(</span><span class="st0">'roles'</span><span class="sy0">,</span> <span class="st0">'roles.id = users_roles.role_id'</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// Execute the query.</span>
<span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<h3><a name="count_records" id="count_records">count_records()</a></h3>
<div class="level3">

<p>

Count query records.

</p>
<ol><li class="level1"><div class="li"> string - table name</div>
</li>
<li class="level1"><div class="li"> array  - where clause</div>
</li>
</ol><pre class="code php"><span class="co1">// Count all the users</span>
<span class="re1">$count</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">count_records</span><span class="br0">(</span><span class="st0">'users'</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// Count banned users</span>
<span class="re1">$banned_users_count</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">count_records</span><span class="br0">(</span><span class="st0">'users'</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'banned'</span> <span class="sy0">=&gt;</span> <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// Or like this</span>
<span class="re1">$banned_users_count</span> <span class="sy0">=</span> <span class="re1">$db</span><span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">(</span><span class="st0">'banned'</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">-&gt;</span><span class="me1">count_records</span><span class="br0">(</span><span class="st0">'users'</span><span class="br0">)</span><span class="sy0">;</span></pre>
</div>

<!-- wikipage stop -->

</div>
<!-- End Body -->


<div id="wikibar" class="clearfix">
	<div class="meta">
		<div class="user">
					</div>
		<div class="doc">
			libraries/database/builder.txt · Last modified: 2008/10/31 15:19 by bobroe			 
		</div>
	</div>

	</div>

<div id="footer"><strong>©2007-2008 Kohana Team. All rights reserved.</strong></div>


<div class="no"><img src="/lib/exe/indexer.php?id=libraries%3Adatabase%3Abuilder&amp;1229411553" width="1" height="1" alt=""></div>
</body></html>
